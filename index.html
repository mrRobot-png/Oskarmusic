<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily Wallet Pro</title>

<style>
    body {
        background: #0f1220;
        color: #eaeaf0;
        font-family: system-ui, sans-serif;
        padding: 20px;
        max-width: 500px;
        margin: auto;
    }

    .card {
        background: rgba(255,255,255,0.08);
        border: 1px solid rgba(255,255,255,0.15);
        border-radius: 14px;
        padding: 16px;
        margin-bottom: 16px;
    }

    h2, h3 { margin: 0 0 10px; color: #4aa3ff; }

    .balance {
        font-size: 2rem;
        font-weight: bold;
        color: #2ecc71;
        text-align: center;
    }

    input {
        width: 100%;
        padding: 12px;
        margin-top: 10px;
        background: rgba(255,255,255,0.05);
        border: 1px solid rgba(255,255,255,0.15);
        border-radius: 8px;
        color: white;
        box-sizing: border-box;
    }

    button {
        padding: 12px;
        margin-top: 10px;
        width: 100%;
        border: none;
        border-radius: 10px;
        font-weight: bold;
        cursor: pointer;
        transition: opacity 0.2s;
    }

    button:active { opacity: 0.7; }

    .green { background: #2ecc71; color: white; }
    .red { background: #ff5c5c; color: white; }
    .blue { background: #4aa3ff; color: white; }
    
    .btn-delete {
        background: #ff5c5c;
        padding: 4px 8px;
        font-size: 0.7rem;
        width: auto;
        margin: 0;
    }

    ul { list-style: none; padding: 0; }
    li {
        padding: 12px 0;
        border-bottom: 1px solid rgba(255,255,255,0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.9rem;
    }

    .muted { color: #a0a3bd; font-size: 0.8rem; }
    
    /* Initially hidden Admin Section */
    #adminSection { 
        display: none; 
        border-top: 2px dashed rgba(255,255,255,0.2); 
        margin-top: 40px; 
        padding-top: 20px; 
    }
</style>
</head>

<body>

<div class="card">
    <div class="muted">Current Balance</div>
    <div class="balance" id="balanceText">Rp 0</div>
</div>

<div class="card">
    <h3>Add Transaction</h3>
    <input type="text" id="amount" placeholder="Amount (e.g. 20.000)" oninput="checkCommand(this.value)">
    <input type="text" id="note" placeholder="Description">
    <div style="display: flex; gap: 10px;">
        <button class="green" onclick="addTransaction('Income')">Income</button>
        <button class="red" onclick="addTransaction('Expense')">Expense</button>
    </div>
</div>

<div class="card">
    <h3>History</h3>
    <ul id="historyList"></ul>
</div>

<div id="adminSection">
    <h3>Admin Panel <span style="font-size: 0.7rem; color: #ff5c5c;">(Unlocked)</span></h3>
    <div class="card">
        <p class="muted">Reset initial funds without creating a transaction log:</p>
        <input id="balanceInput" placeholder="New Balance Value">
        <button class="blue" onclick="setBalance()">Overwrite Balance</button>
    </div>
    
    <div class="card">
        <p class="muted">Manage Logs</p>
        <ul id="adminLogList"></ul>
    </div>
</div>

<script>
    let balance = Number(localStorage.getItem('balance')) || 0;
    let history = JSON.parse(localStorage.getItem('history')) || [];

    // Check for the secret /Admin command
    function checkCommand(val) {
        if (val === '/Admin') {
            const adminPanel = document.getElementById('adminSection');
            const isHidden = window.getComputedStyle(adminPanel).display === 'none';
            
            adminPanel.style.display = isHidden ? 'block' : 'none';
            document.getElementById('amount').value = ''; // Clear the command
            
            if (isHidden) {
                alert("Admin Panel Unlocked!");
            }
        }
    }

    function parseRupiah(value) {
        if (typeof value !== 'string') value = value.toString();
        const cleanValue = value.replace(/\./g, '').replace(/,/g, '');
        return Number(cleanValue);
    }

    function formatRupiah(value) {
        return value.toLocaleString('id-ID');
    }

    function setBalance() {
        const raw = document.getElementById('balanceInput').value;
        const amount = parseRupiah(raw);
        if (isNaN(amount) || raw === '') return alert("Please enter a valid number");

        balance = amount;
        save();
        updateUI();
        document.getElementById('balanceInput').value = '';
        alert("Balance overwritten successfully.");
    }

    function addTransaction(type) {
        const raw = document.getElementById('amount').value;
        const amount = parseRupiah(raw);
        const note = document.getElementById('note').value || 'No note';

        if (isNaN(amount) || amount <= 0) return alert("Please enter a valid amount");

        balance += type === 'Income' ? amount : -amount;

        history.push({
            id: Date.now(),
            type,
            amount,
            note,
            time: new Date().toLocaleString()
        });

        save();
        updateUI();
        document.getElementById('amount').value = '';
        document.getElementById('note').value = '';
    }

    function deleteLog(id) {
        if (!confirm("Are you sure you want to delete this log? Balance will be adjusted.")) return;
        
        const index = history.findIndex(item => item.id === id);
        if (index > -1) {
            const item = history[index];
            balance -= item.type === 'Income' ? item.amount : -item.amount;
            
            history.splice(index, 1);
            save();
            updateUI();
        }
    }

    function updateUI() {
        document.getElementById('balanceText').innerText = `Rp ${formatRupiah(balance)}`;

        const list = document.getElementById('historyList');
        const sortedHistory = [...history].reverse();
        
        list.innerHTML = sortedHistory.slice(0, 5).map(h => `
            <li>
                <div>
                    <strong>${h.type}</strong><br>
                    <span class="muted">${h.note}</span>
                </div>
                <div style="color: ${h.type === 'Expense' ? '#ff5c5c' : '#2ecc71'}">
                    ${h.type === 'Expense' ? '-' : '+'} ${formatRupiah(h.amount)}
                </div>
            </li>
        `).join('');

        const adminList = document.getElementById('adminLogList');
        adminList.innerHTML = sortedHistory.map(h => `
            <li>
                <div style="font-size: 0.8rem">
                    <strong>${h.type}</strong> - ${formatRupiah(h.amount)}<br>
                    <span class="muted">${h.time}</span>
                </div>
                <button class="btn-delete" onclick="deleteLog(${h.id})">Delete</button>
            </li>
        `).join('');
    }

    function save() {
        localStorage.setItem('balance', balance);
        localStorage.setItem('history', JSON.stringify(history));
    }

    updateUI();
</script>

</body>
</html>
    button:active { opacity: 0.7; }

    .green { background: #2ecc71; color: white; }
    .red { background: #ff5c5c; color: white; }
    .blue { background: #4aa3ff; color: white; }
    .btn-delete {
        background: #ff5c5c;
        padding: 4px 8px;
        font-size: 0.7rem;
        width: auto;
        margin: 0;
    }

    ul { list-style: none; padding: 0; }
    li {
        padding: 12px 0;
        border-bottom: 1px solid rgba(255,255,255,0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.9rem;
    }

    .muted { color: #a0a3bd; font-size: 0.8rem; }
    .admin-section { border-top: 2px dashed rgba(255,255,255,0.2); margin-top: 40px; padding-top: 20px; }
</style>
</head>

<body>

<div class="card">
    <div class="muted">Current Balance</div>
    <div class="balance" id="balanceText">Rp 0</div>
</div>

<div class="card">
    <h3>Add Transaction</h3>
    <input type="text" id="amount" placeholder="Amount (e.g. 20.000)">
    <input type="text" id="note" placeholder="Description">
    <div style="display: flex; gap: 10px;">
        <button class="green" onclick="addTransaction('Income')">Income</button>
        <button class="red" onclick="addTransaction('Expense')">Expense</button>
    </div>
</div>

<div class="card">
    <h3>History</h3>
    <ul id="historyList"></ul>
</div>

<div class="admin-section">
    <h3>Admin Panel</h3>
    <div class="card">
        <p class="muted">Reset initial funds without creating a transaction log:</p>
        <input id="balanceInput" placeholder="New Balance Value">
        <button class="blue" onclick="setBalance()">Overwrite Balance</button>
    </div>
    
    <div class="card">
        <p class="muted">Manage Logs</p>
        <ul id="adminLogList"></ul>
    </div>
</div>

<script>
    let balance = Number(localStorage.getItem('balance')) || 0;
    let history = JSON.parse(localStorage.getItem('history')) || [];

    // FIXED: Better parsing to handle strings with or without dots
    function parseRupiah(value) {
        if (typeof value !== 'string') value = value.toString();
        const cleanValue = value.replace(/\./g, '').replace(/,/g, '');
        return Number(cleanValue);
    }

    function formatRupiah(value) {
        return value.toLocaleString('id-ID');
    }

    function setBalance() {
        const raw = document.getElementById('balanceInput').value;
        const amount = parseRupiah(raw);
        if (isNaN(amount) || raw === '') return alert("Please enter a valid number");

        balance = amount;
        save();
        updateUI();
        document.getElementById('balanceInput').value = '';
        alert("Balance overwritten successfully.");
    }

    function addTransaction(type) {
        const raw = document.getElementById('amount').value;
        const amount = parseRupiah(raw);
        const note = document.getElementById('note').value || 'No note';

        if (isNaN(amount) || amount <= 0) return alert("Please enter a valid amount");

        balance += type === 'Income' ? amount : -amount;

        history.push({
            id: Date.now(), // Unique ID for deletion
            type,
            amount,
            note,
            time: new Date().toLocaleString()
        });

        save();
        updateUI();
        document.getElementById('amount').value = '';
        document.getElementById('note').value = '';
    }

    // NEW: Delete specific log and recalculate balance
    function deleteLog(id) {
        if (!confirm("Are you sure you want to delete this log? Balance will be adjusted.")) return;
        
        const index = history.findIndex(item => item.id === id);
        if (index > -1) {
            const item = history[index];
            // Reverse the balance effect
            balance -= item.type === 'Income' ? item.amount : -item.amount;
            
            history.splice(index, 1);
            save();
            updateUI();
        }
    }

    function updateUI() {
        document.getElementById('balanceText').innerText = `Rp ${formatRupiah(balance)}`;

        // Main List
        const list = document.getElementById('historyList');
        const sortedHistory = [...history].reverse();
        
        list.innerHTML = sortedHistory.slice(0, 5).map(h => `
            <li>
                <div>
                    <strong>${h.type}</strong><br>
                    <span class="muted">${h.note}</span>
                </div>
                <div style="color: ${h.type === 'Expense' ? '#ff5c5c' : '#2ecc71'}">
                    ${h.type === 'Expense' ? '-' : '+'} ${formatRupiah(h.amount)}
                </div>
            </li>
        `).join('');

        // Admin List
        const adminList = document.getElementById('adminLogList');
        adminList.innerHTML = sortedHistory.map(h => `
            <li>
                <div style="font-size: 0.8rem">
                    <strong>${h.type}</strong> - ${formatRupiah(h.amount)}<br>
                    <span class="muted">${h.time}</span>
                </div>
                <button class="btn-delete" onclick="deleteLog(${h.id})">Delete</button>
            </li>
        `).join('');
    }

    function save() {
        localStorage.setItem('balance', balance);
        localStorage.setItem('history', JSON.stringify(history));
    }

    updateUI();
</script>

</body>
</html>
